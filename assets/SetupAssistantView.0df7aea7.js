import{U as w,N as x}from"./UpdateListener.8db9cd8c.js";import{a as o,c as a,e as t,t as i,E as R,C as h,D as k,_ as V,q as g,F as v,y as I,f as c,s as f,ag as N,g as T,ah as y,ai as L,aj as M,n as p,ak as m,H as b,z as d,al as B,v as r}from"./index.ef21516a.js";const U={class:"btn-bar btn-bar-wide"},D=["disabled"],W={props:{title:String,nextLabel:{type:String,default:"Next"},isBackVisible:{type:Boolean,default:!0},isNextClickable:{type:Boolean,default:!1}},setup(e){return(n,u)=>(o(),a("div",null,[t("h2",null,i(e.title),1),R(n.$slots,"default"),t("div",U,[h(t("button",{onClick:u[0]||(u[0]=C=>n.$emit("backClicked")),class:"btn btn-lg"},"Back ",512),[[k,e.isBackVisible]]),t("button",{onClick:u[1]||(u[1]=C=>n.$emit("nextClicked")),disabled:!e.isNextClickable,class:"btn btn-lg btn-primary"},i(e.nextLabel),9,D)])]))}};var j="/app/assets/architecture.d8b20a37.png";const _={name:"SetupAssistantView",components:{UpdateListener:w,StepItem:W,NotificationBar:x},data:()=>({sharedStoragePath:"",sharedStorageCheckResult:null,metaAPI:new N(T()),allBlenders:[],autoFoundBlenders:[],isBlenderExeFinding:!1,selectedBlender:null,customBlenderExe:"",isBlenderExeChecking:!1,blenderExeCheckResult:null,sourceLabels:{file_association:"Blender that runs when you double-click a .blend file:",path_envvar:"Blender found on the $PATH environment:",input_path:"Another Blender executable:"},isConfirming:!1,isConfirmed:!1,currentSetupStep:1,overallSetupStep:1,totalSetupSteps:4}),computed:{cleanSharedStoragePath(){return this.sharedStoragePath.trim()},cleanCustomBlenderExe(){return this.customBlenderExe.trim()},isSharedStorageValid(){return this.sharedStorageCheckResult!=null&&this.sharedStorageCheckResult.is_usable},isSelectedBlenderValid(){return this.selectedBlender!=null&&this.selectedBlender.is_usable},isConfigComplete(){return this.isSharedStorageValid&&this.isSelectedBlenderValid},autoFoundBlenderPathEnvvar(){return this.autoFoundBlenders.find(e=>e.source==="path_envvar")},autoFoundBlenderFileAssociation(){return this.autoFoundBlenders.find(e=>e.source==="file_association")},blenderFromInputPath(){return this.allBlenders.find(e=>e.source==="input_path")},setupConfirmIsClickable(){return!(this.isConfirming||this.isConfirmed)}},mounted(){this.findBlenderExePath(),document.body.classList.add("is-setup-assistant")},methods:{onSIOReconnected(){},onSIODisconnected(e){},nextStepAfterCheckSharedStoragePath(){const e=new y(this.cleanSharedStoragePath);return console.log("requesting path check:",e),this.metaAPI.checkSharedStoragePath({pathCheckInput:e}).then(n=>{console.log("Storage path check result:",n),this.sharedStorageCheckResult=n,this.isSharedStorageValid&&this.nextStep()}).catch(n=>{console.log("Error checking storage path:",n)})},nextStepAfterCheckBlenderExePath(){this.checkBlenderExePath(),this.selectedBlender!=null&&this.selectedBlender.is_usable&&this.nextStep()},findBlenderExePath(){this.isBlenderExeFinding=!0,this.autoFoundBlenders=[],console.log("Finding Blender"),this.metaAPI.findBlenderExePath().then(e=>{console.log("Result of finding Blender:",e),this.autoFoundBlenders=e,this._refreshAllBlenders()}).catch(e=>{console.log("Error finding Blender:",e)}).finally(()=>{this.isBlenderExeFinding=!1})},checkBlenderExePath(){const e=this.cleanCustomBlenderExe;if(e==""){this.isBlenderExeChecking=!1,this.blenderExeCheckResult=null,this._refreshAllBlenders();return}this.isBlenderExeChecking=!0,this.blenderExeCheckResult=null;const n=new y(e);console.log("requesting path check:",n),this.metaAPI.checkBlenderExePath({pathCheckInput:n}).then(u=>{console.log("Blender exe path check result:",u),this.blenderExeCheckResult=u,u.is_usable?this.selectedBlender=u:this.selectedBlender!=null&&this.selectedBlender.source==="input_path"&&(this.selectedBlender=null),this._refreshAllBlenders()}).catch(u=>{console.log("Error checking storage path:",u)}).finally(()=>{this.isBlenderExeChecking=!1})},_refreshAllBlenders(){this.blenderExeCheckResult==null||!this.blenderExeCheckResult.is_usable?this.allBlenders=this.autoFoundBlenders:this.allBlenders=this.autoFoundBlenders.concat([this.blenderExeCheckResult])},nextStep(){this.overallSetupStep<=this.currentSetupStep&&(this.overallSetupStep=this.currentSetupStep+1),this.currentSetupStep++},prevStep(){this.currentSetupStep--},jumpToStep(e){e<=this.overallSetupStep&&(this.currentSetupStep=e)},confirmSetupAssistant(){const e=new L(this.sharedStorageCheckResult.path,this.selectedBlender);console.log("saving configuration:",e),this.isConfirming=!0,this.isConfirmed=!1,this.metaAPI.saveSetupAssistantConfig({setupAssistantConfig:e}).then(n=>{console.log("Setup Assistant config saved, reload the page"),this.isConfirmed=!0,window.setTimeout(()=>{window.location.reload()},2e3)}).catch(n=>{console.log("Error saving setup assistan config:",n),this.isConfirming=!1})}}},E=()=>{M(e=>({"609cb3fa":e.totalSetupSteps,"276f7404":e.currentSetupStep}))},A=_.setup;_.setup=A?(e,n)=>(E(),A(e,n)):E;const O=_,q={class:"setup-container"},K=t("h1",null,"Flamenco Setup Assistant",-1),z={class:"progress"},H=["onClick"],Y=t("span",null,null,-1),G=[Y],J=t("div",{class:"progress-bar"},null,-1),Q={class:"setup-step step-welcome"},X=t("p",null," This setup assistant will guide you through the initial configuration of Flamenco. You will be up and running in a few minutes! ",-1),Z=t("p",null,"Before we start, here is a quick overview of the Flamenco architecture.",-1),$=t("img",{src:j,alt:"Flamenco architecture"},null,-1),ee=t("p",null,"The illustration shows the key components and how they interact together:",-1),te=t("ul",null,[t("li",null,[t("strong",null,"Manager"),r(": This application. It coordinates all the activity. ")]),t("li",null,[t("strong",null,"Worker"),r(": A workstation or dedicated rendering machine. It executes the tasks assigned by the Manager. ")]),t("li",null,[t("strong",null,"Shared Storage"),r(": A location accessible by the Manager and the Workers, where the files to be rendered should be saved. ")]),t("li",null,[t("strong",null,"Blender Add-on"),r(": This is needed to connect to the Manager and submit a job from Blender. ")])],-1),ne=t("p",null,[r("More information is available on the online documentation at "),t("a",{href:"https://flamenco.blender.org"},"flamenco.blender.org"),r(". ")],-1),se=t("p",null,"Specify a path (or drive) where you want to store your Flamenco data.",-1),le=t("p",null," The location of the shared storage should be accessible by Flamenco Manager and by the Workers. This could be: ",-1),oe=t("ul",null,[t("li",null,"A local drive or folder (e.g. if you are working by yourself)"),t("li",null,"A NAS in your network"),t("li",null,"Other file sharing server")],-1),ae=t("p",null,[r(" Using services like Dropbox, Syncthing, or ownCloud for this is not recommended, as Flamenco can't coordinate data synchronization. "),t("a",{href:"https://flamenco.blender.org/usage/shared-storage/"},"Learn more"),r(". ")],-1),re={key:0,class:"is-in-progress"},ie={key:1},de=r(" Provide a path to a Blender executable accessible by all Workers. "),ue=t("br",null,null,-1),he=t("br",null,null,-1),ce=r(" If your rendering setup features operating systems different from the one you are currently using, you can manually set up the other paths later. "),pe=[de,ue,he,ce],ke={key:2},Se={key:3},fe={key:0,for:"blender-path_envvar"},ge=["value"],me={class:"setup-path-command"},be={class:"path"},Be={"aria-label":"Console output when running with --version",class:"command-preview","data-microtip-position":"top",role:"tooltip"},_e={key:1,for:"blender-file_association"},Ce=["value"],ve={class:"setup-path-command"},ye={class:"path"},Ee={"aria-label":"Console output when running with --version",class:"command-preview","data-microtip-position":"top",role:"tooltip"},Ae={for:"blender-input_path"},Fe=["value"],Pe={key:0,class:"is-in-progress"},we={key:1,class:"check-failed"},xe={key:4},Re={key:0,class:"is-in-progress"},Ve={key:1,class:"check-failed"},Ie={key:0},Ne=t("p",null,"This is the configuration that will be used by Flamenco:",-1),Te=t("dt",null,"Storage",-1),Le=t("dt",null,"Blender Command",-1),Me={key:0},Ue=r(' Whatever Blender is associated with .blend files (currently "'),De=r('") '),We={key:1},je=r(' The command "'),Oe=r('" as found on '),qe=t("code",null,"$PATH",-1),Ke=r(' (currently "'),ze=r('") '),He={key:2},Ye=r(' The command you provided: "'),Ge=r('" '),Je={key:1,class:"check-ok"},Qe={class:"app-footer"};function Xe(e,n,u,C,Ze,s){const S=g("step-item"),F=g("notification-bar"),P=g("update-listener");return o(),a(v,null,[t("div",q,[K,t("ul",z,[(o(!0),a(v,null,I(e.totalSetupSteps,l=>(o(),a("li",{key:l,onClick:$e=>s.jumpToStep(l),class:p({current:l==e.currentSetupStep,done:l<e.overallSetupStep,done_previously:l<e.overallSetupStep&&e.currentSetupStep>l,done_and_current:l==e.currentSetupStep&&(l<e.overallSetupStep||l==1),disabled:l>e.overallSetupStep})},G,10,H))),128)),J]),t("div",Q,[h(c(S,{onNextClicked:s.nextStep,"is-next-clickable":!0,"is-back-visible":!1,title:"Welcome!","next-label":"Let's go"},{default:f(()=>[X,Z,$,ee,te,ne]),_:1},8,["onNextClicked"]),[[k,e.currentSetupStep==1]]),h(c(S,{onNextClicked:s.nextStepAfterCheckSharedStoragePath,onBackClicked:s.prevStep,"is-next-clickable":e.sharedStoragePath.length>0,title:"Shared Storage"},{default:f(()=>[se,le,oe,ae,h(t("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>e.sharedStoragePath=l),onKeyup:n[1]||(n[1]=m((...l)=>s.nextStepAfterCheckSharedStoragePath&&s.nextStepAfterCheckSharedStoragePath(...l),["enter"])),type:"text",placeholder:"Path to shared storage",class:p({"is-invalid":e.sharedStorageCheckResult!=null&&!e.sharedStorageCheckResult.is_usable})},null,34),[[b,e.sharedStoragePath]]),e.sharedStorageCheckResult!=null?(o(),a("p",{key:0,class:p({"check-ok":e.sharedStorageCheckResult.is_usable,"check-failed":!e.sharedStorageCheckResult.is_usable})},i(e.sharedStorageCheckResult.cause),3)):d("",!0)]),_:1},8,["onNextClicked","onBackClicked","is-next-clickable"]),[[k,e.currentSetupStep==2]]),h(c(S,{onNextClicked:s.nextStepAfterCheckBlenderExePath,onBackClicked:s.prevStep,"is-next-clickable":e.selectedBlender!=null||e.customBlenderExe!="",title:"Blender"},{default:f(()=>[e.isBlenderExeFinding?(o(),a("div",re,"Looking for Blender installs...")):d("",!0),e.autoFoundBlenders.length===0?(o(),a("p",ie,pe)):(o(),a("p",ke,"Choose how a Worker should invoke the Blender command when performing a task:")),e.autoFoundBlenders.length>=1?(o(),a("fieldset",Se,[s.autoFoundBlenderPathEnvvar?(o(),a("label",fe,[t("div",null,[h(t("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>e.selectedBlender=l),value:s.autoFoundBlenderPathEnvvar,id:"blender-path_envvar",name:"blender",type:"radio"},null,8,ge),[[B,e.selectedBlender]]),r(" "+i(e.sourceLabels[s.autoFoundBlenderPathEnvvar.source]),1)]),t("div",me,[t("span",be,i(s.autoFoundBlenderPathEnvvar.path),1),t("span",Be,i(s.autoFoundBlenderPathEnvvar.cause),1)])])):d("",!0),s.autoFoundBlenderFileAssociation?(o(),a("label",_e,[t("div",null,[h(t("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>e.selectedBlender=l),value:s.autoFoundBlenderFileAssociation,id:"blender-file_association",name:"blender",type:"radio"},null,8,Ce),[[B,e.selectedBlender]]),r(" "+i(e.sourceLabels[s.autoFoundBlenderFileAssociation.source]),1)]),t("div",ve,[t("span",ye,i(s.autoFoundBlenderFileAssociation.path),1),t("span",Ee,i(s.autoFoundBlenderFileAssociation.cause),1)])])):d("",!0),t("label",Ae,[t("div",null,[h(t("input",{type:"radio","onUpdate:modelValue":n[4]||(n[4]=l=>e.selectedBlender=l),name:"blender",value:s.blenderFromInputPath,id:"blender-input_path"},null,8,Fe),[[B,e.selectedBlender]]),r(" "+i(e.sourceLabels.input_path),1)]),t("div",null,[h(t("input",{"onUpdate:modelValue":n[5]||(n[5]=l=>e.customBlenderExe=l),onKeyup:n[6]||(n[6]=m((...l)=>s.nextStepAfterCheckBlenderExePath&&s.nextStepAfterCheckBlenderExePath(...l),["enter"])),onFocus:n[7]||(n[7]=l=>e.selectedBlender=null),class:p({"is-invalid":e.blenderExeCheckResult!=null&&!e.blenderExeCheckResult.is_usable}),type:"text",placeholder:"Path to Blender"},null,34),[[b,e.customBlenderExe]]),e.isBlenderExeChecking?(o(),a("p",Pe,"Checking...")):d("",!0),e.blenderExeCheckResult!=null&&!e.blenderExeCheckResult.is_usable?(o(),a("p",we,i(e.blenderExeCheckResult.cause),1)):d("",!0)])])])):d("",!0),e.autoFoundBlenders.length===0?(o(),a("div",xe,[h(t("input",{"onUpdate:modelValue":n[8]||(n[8]=l=>e.customBlenderExe=l),onKeyup:n[9]||(n[9]=m((...l)=>s.nextStepAfterCheckBlenderExePath&&s.nextStepAfterCheckBlenderExePath(...l),["enter"])),class:p({"is-invalid":e.blenderExeCheckResult!=null&&!e.blenderExeCheckResult.is_usable}),type:"text",placeholder:"Path to Blender executable"},null,34),[[b,e.customBlenderExe]]),e.isBlenderExeChecking?(o(),a("p",Re,"Checking...")):d("",!0),e.blenderExeCheckResult!=null&&!e.blenderExeCheckResult.is_usable?(o(),a("p",Ve,i(e.blenderExeCheckResult.cause),1)):d("",!0)])):d("",!0)]),_:1},8,["onNextClicked","onBackClicked","is-next-clickable"]),[[k,e.currentSetupStep==3]]),h(c(S,{onNextClicked:s.confirmSetupAssistant,onBackClicked:s.prevStep,"next-label":"Confirm",title:"Review","is-next-clickable":s.setupConfirmIsClickable},{default:f(()=>[s.isConfigComplete?(o(),a("div",Ie,[Ne,t("dl",null,[Te,t("dd",null,i(e.sharedStorageCheckResult.path),1),Le,e.selectedBlender.source=="file_association"?(o(),a("dd",Me,[Ue,t("code",null,i(e.selectedBlender.path),1),De])):d("",!0),e.selectedBlender.source=="path_envvar"?(o(),a("dd",We,[je,t("code",null,i(e.selectedBlender.input),1),Oe,qe,Ke,t("code",null,i(e.selectedBlender.path),1),ze])):d("",!0),e.selectedBlender.source=="input_path"?(o(),a("dd",He,[Ye,t("code",null,i(e.selectedBlender.path),1),Ge])):d("",!0)])])):d("",!0),e.isConfirmed?(o(),a("p",Je,"Configuration has been saved, Flamenco will restart.")):d("",!0)]),_:1},8,["onNextClicked","onBackClicked","is-next-clickable"]),[[k,e.currentSetupStep==4]])])]),t("footer",Qe,[c(F)]),c(P,{ref:"updateListener",onSioReconnected:s.onSIOReconnected,onSioDisconnected:s.onSIODisconnected},null,8,["onSioReconnected","onSioDisconnected"])],64)}var nt=V(O,[["render",Xe]]);export{nt as default};
